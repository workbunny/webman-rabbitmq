<?php declare(strict_types=1);

namespace Workbunny\WebmanRabbitMQ\Connections;

use Workbunny\WebmanRabbitMQ\BuilderConfig;
use Workbunny\WebmanRabbitMQ\Channels\Channel;
use Workbunny\WebmanRabbitMQ\Clients\AbstractClient;
use Workbunny\WebmanRabbitMQ\Exceptions\WebmanRabbitMQChannelException;
use Workbunny\WebmanRabbitMQ\Exceptions\WebmanRabbitMQConnectException;
use Workbunny\WebmanRabbitMQ\Exceptions\WebmanRabbitMQPublishException;

interface ConnectionInterface
{

    /**
     * 获取原始rabbitmq-client
     *
     * @return AbstractClient
     */
    public function getClient(): AbstractClient;

    /**
     * 是否已连接
     *
     * @return bool
     */
    public function isConnected(): bool;

    /**
     * 获取所有通道
     *
     * @return Channel[]
     */
    public function channels(): array;

    /**
     * 获取一个可用通道
     *
     * @return Channel|null
     * @throws WebmanRabbitMQConnectException
     * @throws WebmanRabbitMQChannelException
     */
    public function channel(): ?Channel;

    /**
     * 发布消息
     *
     * @param BuilderConfig $config
     * @param bool $close
     * @return mixed
     * @throws WebmanRabbitMQConnectException
     * @throws WebmanRabbitMQChannelException
     * @throws WebmanRabbitMQPublishException
     */
    public function publish(BuilderConfig $config, bool $close = false): mixed;

    /**
     * 消费消息
     *
     * @param BuilderConfig $config
     * @return void
     */
    public function consume(BuilderConfig $config): void;

    /**
     * 发送心跳
     *
     * @return void
     * @throws WebmanRabbitMQConnectException
     */
    public function heartbeat(): void;

    /**
     * 连接/重连
     *
     * @param array{replyCode: int, replyText: string} $options
     * @param bool $force 强制重连
     * @return void
     * @throws WebmanRabbitMQConnectException
     */
    public function reconnect(array $options = [], bool $force = true): void;

    /**
     * 关闭连接
     *
     * @param array{replyCode: int, replyText: string} $options
     * @return void
     * @throws WebmanRabbitMQConnectException
     */
    public function disconnect(array $options = []): void;
}
